<app-sidebar></app-sidebar>
<div class="main-header"><app-header-user></app-header-user></div>

<div class="dashboard-wrapper">

  <div class="container-center">

    <div class="card-form">
      <h2>Solicitud Justificación</h2>
      <p class="subtitle">Justifica tus tardanzas o inasistencias</p>

      <form (ngSubmit)="enviarSolicitud()" #justForm="ngForm">

        <div class="form-group">
          <label>Selecciona la incidencia a justificar *</label>

          <select name="fecha" [(ngModel)]="solicitud.fechaIncidencia" required class="form-input" #fechaRef="ngModel">

            <option value="" disabled selected>-- Selecciona un día --</option>

            <option *ngFor="let item of listaIncidencias" [value]="item.fecha">
              {{ item.fecha | date:'dd/MM/yyyy' }} - {{ item.tipo }} ({{ item.detalle }})
            </option>

          </select>

          <small *ngIf="fechaRef.invalid && fechaRef.touched" class="text-error">
            Debes seleccionar una incidencia.
          </small>
          <small *ngIf="listaIncidencias.length === 0" class="text-info">
             No tienes faltas ni tardanzas pendientes por justificar.
          </small>
        </div>

        <div class="form-group">
          <label>Motivo / Explicación</label>
          <textarea name="motivo" [(ngModel)]="solicitud.motivo" required minlength="10" rows="4" class="form-input"
            placeholder="Ej: Cita médica, paro de transporte, tráfico..." #motivoRef="ngModel">
          </textarea>

          <small *ngIf="motivoRef.invalid && motivoRef.touched" class="text-error">
            El motivo es obligatorio (mínimo 10 letras).
          </small>
        </div>

        <button type="submit" [disabled]="justForm.invalid || cargando" class="btn-block">
          {{ cargando ? 'Enviando...' : 'Enviar Solicitud' }}
        </button>

      </form>

      <div *ngIf="mensajeResultado" class="alert" [ngClass]="esError ? 'alert-error' : 'alert-success'">
        {{ mensajeResultado }}
      </div>

    </div>
  </div>
</div>
