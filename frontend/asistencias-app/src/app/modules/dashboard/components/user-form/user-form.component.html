<app-sidebar></app-sidebar>
<div class="overlay-backdrop">
  <div class="form-card">

    <div class="form-header">
      <h2>{{ titulo }}</h2>
      <button class="btn-close" (click)="cerrar()">
        <i class="uil uil-times"></i>
      </button>
    </div>

    <form (ngSubmit)="guardar()" #form="ngForm">

      <div class="form-row">
        <div class="form-group">
          <label>Usuario *</label>
          <input type="text" name="username" [(ngModel)]="userForm.username" required #usernameInput="ngModel"
            class="form-input"
            [class.is-invalid]="usernameInput.invalid && (usernameInput.dirty || usernameInput.touched)">

          <div *ngIf="usernameInput.invalid && (usernameInput.dirty || usernameInput.touched)" class="error-msg">
            <small *ngIf="usernameInput.errors?.['required']">El usuario es obligatorio.</small>
          </div>
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input type="email" name="email" [(ngModel)]="userForm.email" required email #emailInput="ngModel"
            class="form-input" [class.is-invalid]="emailInput.invalid && (emailInput.dirty || emailInput.touched)">

          <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched)" class="error-msg">
            <small *ngIf="emailInput.errors?.['required']">El correo es obligatorio.</small>
            <small *ngIf="emailInput.errors?.['email']">Formato de correo inválido.</small>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Nombre Completo *</label>
        <input type="text" name="nombre" [(ngModel)]="userForm.nombreCompleto" required minlength="3"
          #nombreInput="ngModel" class="form-input"
          [class.is-invalid]="nombreInput.invalid && (nombreInput.dirty || nombreInput.touched)">

        <div *ngIf="nombreInput.invalid && (nombreInput.dirty || nombreInput.touched)" class="error-msg">
          <small *ngIf="nombreInput.errors?.['required']">El nombre es obligatorio.</small>
          <small *ngIf="nombreInput.errors?.['minlength']">Mínimo 3 caracteres.</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Rol *</label>
          <select name="rol" [(ngModel)]="userForm.idRol" class="form-input">
            <option [value]="2">EMPLEADO</option>
            <option [value]="1">ADMIN</option>
          </select>
        </div>

        <div class="form-group">
          <label>Contraseña <span *ngIf="!userToEdit">*</span></label>
          <input type="password" name="password" [(ngModel)]="userForm.password" [required]="!userToEdit" minlength="6"
            #passInput="ngModel" class="form-input"
            placeholder="{{ userToEdit ? 'Dejar vacío para mantener actual' : '' }}"
            [class.is-invalid]="passInput.invalid && (passInput.dirty || passInput.touched)">

          <div *ngIf="passInput.invalid && (passInput.dirty || passInput.touched)" class="error-msg">
            <small *ngIf="passInput.errors?.['required']">La contraseña es obligatoria.</small>
            <small *ngIf="passInput.errors?.['minlength']">Mínimo 6 caracteres.</small>
          </div>
        </div>
      </div>

      <div *ngIf="mensajeError" class="alert-error">
        <i class="uil uil-exclamation-triangle"></i> {{ mensajeError }}
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="cerrar()">Cancelar</button>
        <button type="submit" class="btn-save" [disabled]="form.invalid || cargando">
          {{ cargando ? 'Guardando...' : 'Guardar Datos' }}
        </button>
      </div>

    </form>
  </div>
</div>
